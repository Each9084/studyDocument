# 拷贝

在计算机的世界里，**“拷贝”（Copy）** 并不是简单的“复制粘贴”。因为数据在内存中分为**“地址（门牌号）”**和**“对象（房子本身）”**，所以当你想要复制一份数据时，就会出现三种不同的深度。

我们可以用**“给房产证拍照”**还是**“照着建一栋新房”**来简单理解。

------

### 1. 引用拷贝 (Reference Copy) —— “多办一张房产证”

这是最浅的拷贝，甚至称不上是真正的拷贝。

- **操作**：`List list2 = list1;`
- **本质**：你只是多创建了一个标签（变量），两个标签指向的还是**同一个内存地址**。
- **后果**：你通过 `list2` 装修房子，`list1` 看到的也是装修后的样子。
- **比喻**：我和你共享一个房子，我有钥匙，你也有钥匙。你把沙发换了，我回来发现沙发也变了。

------

### 2. 浅拷贝 (Shallow Copy) —— “建个新房，但家具是共享的”

这是 Java 中很多默认克隆方法（如 `clone()`）的行为。

- **操作**：创建一个新的集合对象，但里面的元素还是旧的。
- **本质**：你建了一栋新房子，但房子里的家具（对象引用）全是从旧房子里拉出来的。
- **后果**：
  - 如果你把新房子拆了（删除 `list2` 的元素），旧房子没事。
  - 但如果你坐在新房里，把那个共享的家具（对象内部的 `val`）改了，旧房子里的家具也变了。
- **比喻**：我们住两家不同的酒店房间，但我们共用同一个服务员。如果你把服务员打伤了，我也没服务员用了。

------

### 3. 深拷贝 (Deep Copy) —— “完全克隆一个平行世界”

这是最彻底的拷贝，也是数据开发（DE）中最耗费性能的操作。

- **操作**：不仅新开辟一块集合空间，连集合里的每一个对象，都要在内存里重新创建一遍。
- **本质**：从头到尾，每一个字节都是全新的。
- **后果**：两个对象从此“老死不相往来”，互不干扰。
- **比喻**：我照着你的样子，通过克隆技术造了一个完美的“克隆人”。他感冒了，你依然活蹦乱跳。

------

### 4. 为什么数据开发（DE）要分这么细？

在处理大数据（比如 Spark 的 RDD 转换）时，拷贝的选择决定了你的代码是**“起飞”**还是**“崩溃”**：

1. **性能成本**：深拷贝非常消耗内存和 CPU。如果你有 1 亿条数据，做一次深拷贝可能会直接导致 $OOM$（内存溢出）。
2. **不可变性 (Immutability)**：在分布式计算中，我们推崇“数据不可变”。通常我们会用浅拷贝（或只读视图）来提高效率，因为这样安全又快。
3. **Bug 隐患**：如果你在多线程环境下用了浅拷贝，线程 A 改了数据，线程 B 就会一脸懵逼，这种 Bug 极难排查。

------



### 5.同样是引用,引用拷贝和浅拷贝有什么区别

**引用拷贝 (Reference Copy)**：

- **没有新对象**。
- 只是给**同一个内存地址**多贴了一个标签。
- **结果**：1个房子，2个房产证。

**浅拷贝 (Shallow Copy)**：

- **新造了一个对象（容器）**。
- 但是，新容器里面的**内容**（如果内容是对象的话），是直接复制的旧容器里的**地址**。
- **结果**：2个房子（双胞胎），但房子里的家具是共用的（通过某种量子纠缠，家具其实是同一个）。



| **维度**                     | **引用拷贝**            | **浅拷贝**                             |
| ---------------------------- | ----------------------- | -------------------------------------- |
| **创建新对象吗？**           | **不创建**              | **创建**（仅限最外层容器）             |
| **修改容器本身**（加减元素） | 互相影响                | **互不影响**                           |
| **修改内部对象属性**         | 互相影响                | **互相影响**                           |
| **比喻**                     | 共享同一个 Netflix 账号 | 两个账号，但共享同一个“观看历史”数据库 |



### 💡 总结

| **拷贝类型** | **复制了什么？** | **修改其中一个，另一个会变吗？** | **性能** |
| ------------ | ---------------- | -------------------------------- | -------- |
| **引用拷贝** | 地址             | **会** (完全是同一个东西)        | 极快     |
| **浅拷贝**   | 容器本身         | **部分会** (容器变了，内容没变)  | 快       |
| **深拷贝**   | 容器 + 所有内容  | **完全不会**                     | 慢       |

------

